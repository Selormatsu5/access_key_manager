{% extends 'keys/base.html' %}

<style>
    .logout-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background-color: #f8f9fa;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }

    .logout-btn a {
        color: #007bff;
        text-decoration: underline;
    }
</style>

{% block content %}
<div class="container fluid">
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn">Logout</button>
    </form>
    <h2>Dashboard</h2>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <h3>Your Active Access Key</h3>
    <table>
        <thead>
            <tr>
                <th>Key</th>
                <th>Status</th>
                <th>Expiry Date</th>
            </tr>
        </thead>
        <tbody>
            {% for key in active_keys %}
            <tr>
                <td>{{ key.key }}</td>
                <td>{{ key.status }}</td>
                <td>{{ key.expiry_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Your Previous Access Keys</h3>
    <table>
        <thead>
            <tr>
                <th>Key</th>
                <th>Status</th>
                <th>Expiry Date</th>
            </tr>
        </thead>
        <tbody>
            {% for key in previous_keys %}
            <tr>
                <td>{{ key.key }}</td>
                <td>{{ key.status }}</td>
                <td>{{ key.expiry_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <form method="post">
        {% csrf_token %}
        <button type="submit" name="generate_key">Generate New Key</button>
    </form>

    {% if user.user_type == 'Admin' %}
    <h3>IT Personnel</h3>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            {% for it_user in it_users %}
            <tr>
                <td>{{ it_user.username }}</td>
                <td>{{ it_user.email }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>All Access Keys</h3>
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Key</th>
                <th>Status</th>
                <th>Expiry Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for key in active_keys %}
            <tr>
                <td>{{ key.user.username }}</td>
                <td>{{ key.key }}</td>
                <td>{{ key.status }}</td>
                <td>{{ key.expiry_date }}</td>
                <td>
                    {% if key.status == 'active' %}
                    <form method="post" action="{% url 'revoke_key' key.id %}">
                        {% csrf_token %}
                        <button type="submit">Revoke</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            {% for key in previous_keys %}
            <tr>
                <td>{{ key.user.username }}</td>
                <td>{{ key.key }}</td>
                <td>{{ key.status }}</td>
                <td>{{ key.expiry_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>

{% endblock %}
